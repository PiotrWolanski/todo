<!doctype html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Task Manager (Flask)</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .task-done { text-decoration: line-through; opacity: 0.7; }
    .small-mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
  </style>
</head>
<body class="bg-light">
  <div class="container py-4" style="max-width: 900px;">
    <div class="d-flex align-items-center justify-content-between mb-3">
      <div>
        <h1 class="h3 mb-0">Task Manager</h1>
        <div class="text-muted">Flask + JSON storage</div>
      </div>
      <div class="text-end">
        <div class="small text-muted">Widok:</div>
        <div class="btn-group" role="group">
          <a class="btn btn-outline-primary btn-sm {{ 'active' if view=='all' else '' }}" href="/?view=all">
            Wszystkie ({{ counts.all }})
          </a>
          <a class="btn btn-outline-primary btn-sm {{ 'active' if view=='active' else '' }}" href="/?view=active">
            Aktywne ({{ counts.active }})
          </a>
          <a class="btn btn-outline-primary btn-sm {{ 'active' if view=='done' else '' }}" href="/?view=done">
            Zrobione ({{ counts.done }})
          </a>
        </div>
      </div>
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="mb-3">
          {% for category, msg in messages %}
            <div class="alert alert-{{ category }} py-2 mb-2">{{ msg }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <form method="post" action="/add?view={{ view }}" class="row g-2 align-items-center">
          <div class="col-12 col-md-9">
            <input class="form-control" name="title" placeholder="Wpisz nowe zadanie..." minlength="2" required />
          </div>
          <div class="col-12 col-md-3 d-grid">
            <button class="btn btn-primary" type="submit">Dodaj</button>
          </div>
        </form>
      </div>
    </div>

    <div class="card shadow-sm">
      <div class="card-header d-flex align-items-center justify-content-between">
        <div class="fw-semibold">Lista zadań</div>
        <form method="post" action="/clear_done?view={{ view }}">
          <button class="btn btn-outline-danger btn-sm" type="submit" {{ 'disabled' if counts.done==0 else '' }}>
            Usuń wykonane
          </button>
        </form>
      </div>

      <div class="card-body p-0">
        {% if tasks|length == 0 %}
          <div class="p-4 text-center text-muted">Brak zadań w tym widoku.</div>
        {% else %}
          <div class="list-group list-group-flush">
            {% for t in tasks %}
              <div class="list-group-item d-flex align-items-center justify-content-between">
                <div class="d-flex flex-column">
                  <div class="{{ 'task-done' if t.done else '' }}">
                    {{ t.title }}
                  </div>
                  <div class="text-muted small small-mono">ID: {{ t.id }} • {{ t.created_at }}</div>
                </div>

                <div class="d-flex gap-2">
                  <form method="post" action="/toggle/{{ t.id }}?view={{ view }}">
                    <button class="btn btn-sm {{ 'btn-success' if not t.done else 'btn-secondary' }}" type="submit">
                      {{ 'Zrobione' if not t.done else 'Cofnij' }}
                    </button>
                  </form>
                  <form method="post" action="/delete/{{ t.id }}?view={{ view }}" onsubmit="return confirm('Usunąć zadanie?');">
                    <button class="btn btn-sm btn-outline-danger" type="submit">Usuń</button>
                  </form>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="text-muted small mt-3">
      Dane są zapisywane lokalnie w pliku <span class="small-mono">data/tasks.json</span>.
    </div>
  </div>
</body>
</html>
